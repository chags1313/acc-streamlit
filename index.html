<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
  <link rel="icon" href="favicon.ico">
  <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.1/control_utils.css" crossorigin="anonymous">
  <link rel="stylesheet" type="text/css" href="demo.css" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.1/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils@0.1/control_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils@0.2/drawing_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.1/holistic.js" crossorigin="anonymous"></script>
</head>

<body>
  <!-- Floating Action Button -->
  <div class="floating-button">
    <button id="startButton" class="button is-info">Start Holistic Pose Detection</button>
    <button id="stopButton" class="button is-danger is-hidden">Stop Holistic Pose Detection</button>
  </div>

  <!-- Holistic Pose Detection Results -->
  <div id="holisticResults" class="is-hidden">
    <canvas id="canvas" width="640" height="480"></canvas>
  </div>

  <script>
    const video = document.createElement('video');
    const canvas = document.getElementById('canvas');
    const holisticResults = document.getElementById('holisticResults');
    const startButton = document.getElementById('startButton');
    const stopButton = document.getElementById('stopButton');

    const canvasCtx = canvas.getContext('2d');
    const holistic = new Holistic();

    async function startHolisticPoseDetection() {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      video.srcObject = stream;
      video.play();

      startButton.classList.add('is-hidden');
      stopButton.classList.remove('is-hidden');
      holisticResults.classList.remove('is-hidden');

      const camera = new Camera(video, {
        onFrame: async () => {
          await holistic.send({ image: video });
        },
        width: 640,
        height: 480
      });
      camera.start();
    }

    function stopHolisticPoseDetection() {
      video.srcObject.getTracks()[0].stop();

      startButton.classList.remove('is-hidden');
      stopButton.classList.add('is-hidden');
      holisticResults.classList.add('is-hidden');
    }

    function drawResults(results) {
      canvasCtx.clearRect(0, 0, canvas.width, canvas.height);
      canvasCtx.drawImage(results.image, 0, 0, canvas.width, canvas.height);
      drawConnectors(canvasCtx, results.poseLandmarks, POSE_CONNECTIONS, { color: '#00FF00', lineWidth: 4 });
      drawLandmarks(canvasCtx, results.poseLandmarks, { color: '#FF0000', lineWidth: 2, radius: 4 });
    }

    holistic.onResults(drawResults);

    startButton.addEventListener('click', startHolisticPoseDetection);
    stopButton.addEventListener('click', stopHolisticPoseDetection);
  </script>
</body>
</html>
