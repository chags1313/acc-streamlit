<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mediapipe Holistic Pose Detection</title>
  <style>
    body {
      background-color: #1a1c1e;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }

    .floating-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: #03a9f4;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.26);
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .floating-button:hover {
      background-color: #0288d1;
    }

    .floating-button-icon {
      color: #fff;
      font-size: 24px;
    }
  </style>
</head>

<body>
  <video class="input_video4" playsinline></video>
  <canvas class="output4" width="480px" height="480px"></canvas>
  
  <div class="floating-button" id="startButton">
    <i class="floating-button-icon material-icons">play_arrow</i>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils@0.1/camera_utils.js" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic@0.1/holistic.js" crossorigin="anonymous"></script>
  <script>
    class FPS {
      constructor() {
        this.startTime = 0;
        this.prevTime = 0;
        this.frameCount = 0;
        this.fps = 0;
      }

      tick() {
        const currentTime = Date.now();
        this.frameCount++;
        if (currentTime > this.startTime + 1000) {
          this.fps = Math.round((this.frameCount * 1000) / (currentTime - this.startTime));
          this.startTime = currentTime;
          this.frameCount = 0;
        }
      }
    }

    const video4 = document.getElementsByClassName('input_video4')[0];
    const out4 = document.getElementsByClassName('output4')[0];
    const startButton = document.getElementById('startButton');
    const canvasCtx4 = out4.getContext('2d');

    const fpsControl = new FPS();

    function onResultsHolistic(results) {
      // Process results and draw on canvas
      // ...

      fpsControl.tick();
      canvasCtx4.clearRect(0, 0, out4.width, out4.height);
      // Draw results on the canvas
      // ...
    }

    const holistic = new Holistic();
    holistic.onResults(onResultsHolistic);

    const camera = new Camera(video4, {
      onFrame: async () => {
        await holistic.send({ image: video4 });
      },
      width: 480,
      height: 480
    });

    startButton.addEventListener('click', () => {
      if (!camera.active) {
        // Start pose detection
        camera.start();
        startButton.innerHTML = '<i class="floating-button-icon material-icons">stop</i>';
      } else {
        // Stop pose detection
        camera.stop();
        startButton.innerHTML = '<i class="floating-button-icon material-icons">play_arrow</i>';
        canvasCtx4.clearRect(0, 0, out4.width, out4.height);
      }
    });
  </script>
</body>
</html>
